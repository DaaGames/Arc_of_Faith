<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arc of Faith</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Open+Sans&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <nav>
    <div class="logo">ARC OF FAITH</div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="seasons.html">Seasons</a></li>
      <li><a href="community.html">Community</a></li>
    </ul>
  </nav>

  <header>
    <h1>ARCFALL</h1>
    <p class="tagline">A Biblical Adventure Awaits</p>
  </header>

  <main>
    <section class="section">
      <h2>Season 1: The Ark Awakens</h2>
      <p>Explore the mysteries of the island, uncover the lost Arc Engine, and prepare for anything.</p>
      <a class="btn" href="https://youtube.com/@arcfall_yt?si=kMsHjd5q6om5ne-8" target="_blank" rel="noopener noreferrer">Visit YouTube</a>
    </section>

    <section class="section">
      <button class="btn" onclick="toggleLearnMore()">Learn More</button>
      <div id="learnMoreText" class="learn-more-text">Arc of Faith is a fast-paced third-person shooter set in a world touched by the lost Arc Engine. Each season is inspired by a different biblical story and features a race to control the world-altering Arc Engineâ€”a device capable of bending reality itself.</div>
    </section>

    <section class="section voting">
      <h2>Vote for the Next Item</h2>
      <div id="countdown-timer">Loading countdown...</div>
      <div class="vote-options">
        <div class="vote-box" data-id="option1">
          <div class="vote-image"></div>
          <p>New Phoenix Armor Set</p>
          <div class="vote-bar-container">
            <div class="vote-bar" id="bar-option1"></div>
          </div>
          <p id="percent-option1">0%</p>
          <button class="btn" data-option="option1">Vote</button>
        </div>
        <div class="vote-box" data-id="option2">
          <div class="vote-image"></div>
          <p>Dungeon Map Expansion</p>
          <div class="vote-bar-container">
            <div class="vote-bar" id="bar-option2"></div>
          </div>
          <p id="percent-option2">0%</p>
          <button class="btn" data-option="option2">Vote</button>
        </div>
        <div class="vote-box" data-id="option3">
          <div class="vote-image"></div>
          <p>Mount Customization</p>
          <div class="vote-bar-container">
            <div class="vote-bar" id="bar-option3"></div>
          </div>
          <p id="percent-option3">0%</p>
          <button class="btn" data-option="option3">Vote</button>
        </div>
        <div class="vote-box" data-id="option4">
          <div class="vote-image"></div>
          <p>Fishing Mini-Game</p>
          <div class="vote-bar-container">
            <div class="vote-bar" id="bar-option4"></div>
          </div>
          <p id="percent-option4">0%</p>
          <button class="btn" data-option="option4">Vote</button>
        </div>
      </div>
    </section>
  </main>

  <footer>Daa Games</footer>

  <script>
    function toggleLearnMore() {
      const text = document.getElementById("learnMoreText");
      text.classList.toggle("visible");
    }
  </script>

  <script type="module">
    import {
      initializeAndGetVotingStatus,
      getVotingOptionsData,
      castVote,
      setVoteButtonsState,
      updateVoteUI,
      startCountdown,
      listenForVoteChanges
    } from './voting.js';

    async function setupVoting() {
      // Initialize voting session and get status
      const status = await initializeAndGetVotingStatus();

      // Update countdown timer UI
      startCountdown("countdown-timer", status.remainingMs, () => {
        setVoteButtonsState(false);
      });

      // Enable/disable vote buttons depending on session status & if user voted
      setVoteButtonsState(status.isActive);

      // Update votes UI initially
      const optionsData = await getVotingOptionsData();
      updateVoteUI(optionsData);

      // Listen for live vote updates and update UI on change
      listenForVoteChanges(updateVoteUI);

      // Attach click handlers for voting buttons
      document.querySelectorAll(".vote-box button").forEach(btn => {
        btn.addEventListener("click", async () => {
          if (localStorage.getItem("votedOption")) {
            alert("You already voted!");
            return;
          }
          const optionId = btn.getAttribute("data-option");
          if (!optionId) return;

          const success = await castVote(optionId);
          if (success) {
            localStorage.setItem("votedOption", optionId);
            setVoteButtonsState(false);
            alert("Thanks for voting!");
          } else {
            alert("Voting has ended or there was an error.");
          }
        });
      });
    }

    setupVoting();
  </script>
</body>
</html>
